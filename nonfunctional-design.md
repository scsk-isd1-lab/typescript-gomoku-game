# 内部設計書（非機能設計）

## 文書情報
- **文書名**: 内部設計書（非機能設計）
- **バージョン**: 1.0
- **作成日**: 2024-05-03
- **作成者**: Design Agent
- **対象システム**: TypeScript Gomoku Game
- **機能設計書参照**: s3://isd1-lab-bedrock-artifacts/run-20240503/10_design_functional/openapi.yaml

## インフラストラクチャ設計

### デプロイメントアーキテクチャ

#### 環境

##### 開発環境
- **説明**: 開発者のローカル環境
- **コンポーネント**:
  - **ローカルWebサーバー**: 開発用のWebサーバー（npm/yarn devサーバー）

##### 本番環境
- **説明**: 静的WebホスティングサービスでのデプロイメントA
- **コンポーネント**:
  - **静的Webサーバー**: GitHub Pagesなどの静的ホスティングサービス

#### ネットワークアーキテクチャ
- **説明**: クライアントサイドのみの実装のため、特別なネットワーク構成は不要。HTTPSによる安全な通信を確保する。
- **図表参照**: ブラウザ → HTTPS → 静的Webサーバー

## パフォーマンス設計

### 応答時間要件

- **画面初期ロード**
  - **要件**: 2秒以内
  - **測定方法**: Lighthouse性能スコア

- **石の配置アクション**
  - **要件**: 100ms以内
  - **測定方法**: ブラウザのパフォーマンスプロファイラ

### リソース利用

- **メモリ使用量**
  - **制限**: 50MB以下
  - **測定方法**: ブラウザの開発者ツール

- **CPU使用率**
  - **制限**: 平均20%以下（スマートフォンの場合）
  - **測定方法**: ブラウザの開発者ツール

### 最適化戦略

- **アセット最適化**
  - **説明**: 画像やCSSの最小化、必要に応じた遅延読み込み

- **レンダリング最適化**
  - **説明**: 必要な部分のみの再描画によるパフォーマンス向上

- **計算処理の最適化**
  - **説明**: 勝敗判定ロジックの効率化（必要な方向のみチェック）

## セキュリティ設計

### 脅威モデル

- **スコープ**: クライアントサイドのブラウザゲーム
- **前提条件**:
  - サーバーとの通信はない
  - ローカルストレージに機密データは保存しない

- **脅威**:
  - **クライアントサイドの改ざん**
    - **リスク**: 低
    - **対策**: 競技性を重視しない単純なゲームであるため、特別な対策は不要

### 防御的コーディング

- **入力検証**
  - **実装**: ユーザー操作（クリック位置）の有効性確認

- **安全なリソース読み込み**
  - **実装**: Content Security Policyの適用

## 信頼性設計

### エラー処理

- **無効な操作**
  - **戦略**: ユーザーフレンドリーなエラーメッセージを表示
  - **実装**: エラー状態をUI上で明示的に表示し、有効な操作を促す

### 状態管理

- **一貫性のある状態管理**
  - **実装**: TypeScriptの型システムを活用したゲーム状態の一元管理

- **状態の永続化**
  - **実装**: オプションとして、ゲーム状態をlocalStorageに保存し、ページのリロードでも状態を維持できるようにする

## スケーラビリティ設計

### スケーリング考慮事項

- **デバイス対応**
  - **戦略**: レスポンシブデザインの適用、タッチデバイスとマウスデバイスの両対応

### キャパシティプランニング

- **説明**: クライアントサイドのみの実装であり、サーバー側のキャパシティプランニングは不要

## メンテナビリティ設計

### コード編成

- **モジュール化**
  - **実装**: 機能別にモジュールを分け、関心の分離を実現

- **型定義**
  - **実装**: TypeScriptのインターフェースと型を活用した堅牢な実装

### 文書化

- **コードコメント**
  - **標準**: TSDocスタイルのコメント

- **README**
  - **内容**: セットアップ手順、アーキテクチャ概要、拡張方法の説明

### バージョン管理

- **GitFlow**
  - **ブランチ戦略**: feature/, develop, main ブランチの活用

- **コミット規約**
  - **標準**: Conventional Commits（feat, fix, docs, style, refactor, test, chore）

## 互換性設計

### ブラウザサポート

- **Chrome**: 最新2バージョン
- **Firefox**: 最新2バージョン
- **Safari**: 最新2バージョン
- **Edge**: 最新2バージョン

### レスポンシブデザイン

#### ブレークポイント

- **Mobile** (< 768px)
  - **適応**: 縮小したボード、垂直方向のUIレイアウト

- **Tablet** (768px - 1024px)
  - **適応**: 中サイズのボード、最適化されたUIレイアウト

- **Desktop** (> 1024px)
  - **適応**: フルサイズのボード、水平方向のUIレイアウト

## アクセシビリティ設計

### 標準

- **WCAG 2.1 Level A**
  - **適合戦略**: コントラスト比の確保、キーボードナビゲーション対応

### 機能

- **キーボード操作**
  - **実装**: 矢印キーでのカーソル移動、Enterキーでの石配置

- **スクリーンリーダー対応**
  - **実装**: 適切なARIA属性の付与、ゲーム状態の通知

- **色覚異常対応**
  - **実装**: 黒と白のコントラストに加え、オプションでパターン表示も可能に

## モニタリング設計

### クライアントサイドモニタリング

- **パフォーマンスメトリクス**
  - **ツール**: web-vitals ライブラリ
  - **実装**: コアWebバイタルの測定（FCP、LCP、CLS）

- **エラー追跡**
  - **ツール**: カスタムエラーハンドラー
  - **実装**: コンソールログとオプションのエラーレポート機能

## ビルドとデプロイメント

### ビルドプロセス

#### ツール
- **TypeScript Compiler**: 4.x or later
- **Webpack/Vite**: 最新安定版

#### 手順
1. **型チェック**: `tsc --noEmit`
2. **ビルド**: `npm run build`
3. **テスト実行**: `npm test`

### デプロイメントプロセス

#### 環境
- **開発**: ローカル開発サーバー（npm run dev）
- **本番**: ビルド成果物をGitHub Pagesにデプロイ（GitHub Actions経由）

#### 自動化
- **GitHub Actions**: ビルド、テスト、デプロイの自動化

## テスト戦略

### テストレベル

- **単体テスト**
  - **ツール**: Jest
  - **カバレッジ目標**: 80%

- **E2Eテスト**
  - **ツール**: Playwright
  - **シナリオ**: 基本的なゲームプレイフロー

### パフォーマンステスト

- **フロントエンドパフォーマンス**
  - **ツール**: Lighthouse CI
  - **メトリクス**: FCP, TTI, CLS

## 開発環境

### セットアップ

#### 前提条件
- **Node.js**: 14.x or later
- **npm/yarn**: 最新安定版

#### 手順
1. **リポジトリのクローン**: `git clone [repository-url]`
2. **依存関係のインストール**: `npm install`
3. **開発サーバーの起動**: `npm run dev`

### 開発ツール

- **IDE**: VS Code with TypeScript and ESLint extensions
- **デバッグ**: ブラウザ開発者ツール、VS Code Debugger

## 将来の考慮事項

### 潜在的な機能拡張

- **AIプレイヤー**
  - **複雑さ**: 中
  - **説明**: シンプルなAIアルゴリズムの実装

- **オンライン対戦**
  - **複雑さ**: 高
  - **説明**: WebSocketやFirebaseを使用したリアルタイム対戦機能

- **カスタムルール**
  - **複雑さ**: 低
  - **説明**: ボードサイズやルールのカスタマイズオプション

### 技術的負債

- **レンダリングエンジン**
  - **リスク**: 低
  - **説明**: 将来的にはCanvasからWebGLへの移行も検討可能