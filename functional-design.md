# 外部設計書（機能設計）

## 文書情報
- **文書名**: 外部設計書（機能設計）
- **バージョン**: 1.0
- **作成日**: 2024-05-03
- **作成者**: Design Agent
- **対象システム**: TypeScript Gomoku Game
- **要件定義書参照**: s3://isd1-lab-bedrock-artifacts/run-20240503/00_requirements/requirements.yaml

## システムアーキテクチャ

### 概要
TypeScriptとモダンなWebテクノロジーを利用したブラウザベースの五目並べゲーム。シンプルな構成で、フロントエンドのみの実装となる。

### コンポーネント

#### GameBoard
- **説明**: 19x19のゲームボードを表示し、石の配置を管理するコンポーネント
- **責務**: ボードの描画、ユーザー操作の処理、石の配置状態管理
- **インターフェース**: BoardController

#### GameController
- **説明**: ゲームの進行状態を管理するコントローラー
- **責務**: ターン管理、勝敗判定、ゲームリセット
- **インターフェース**: GameBoard, GameStatus

#### GameStatus
- **説明**: 現在のゲーム状態を表示するコンポーネント
- **責務**: 現在のプレイヤーターンの表示、勝者または引き分けの表示
- **インターフェース**: GameController

#### ResetButton
- **説明**: ゲームをリセットするためのボタン
- **責務**: ユーザー入力を受け付け、ゲームのリセットをトリガーする
- **インターフェース**: GameController

## ユーザーインターフェース

### ワイヤーフレーム

#### メイン画面
- **説明**: ゲームの主要画面。ゲームボードと操作UIを含む
- **コンポーネント**:
  - **canvas** - ゲームボード: 19x19のマス目を描画し、クリックで石を配置
  - **text** - ステータス表示: 現在のプレイヤーターンや勝敗結果を表示
  - **button** - リセット: クリックでゲームをリセット

### ナビゲーションフロー
- **ゲーム開始** → **ゲームプレイ**: 画面の初期ロード
- **ゲームプレイ** → **ゲーム終了**: 勝敗決定またはボードが埋まる
- **ゲーム終了** → **ゲームプレイ**: リセットボタン押下

## データ設計

### エンティティ

#### Board
- **説明**: ゲームボードの状態を表すデータ構造
- **属性**:
  - **grid** (array[19][19], 必須): 各交点の状態（空、黒、白）を保持する2次元配列
  - **size** (number, 必須): ボードのサイズ（19x19）

#### GameState
- **説明**: ゲームの現在の状態を表すデータ構造
- **属性**:
  - **currentPlayer** (enum (BLACK, WHITE), 必須): 現在のプレイヤー
  - **status** (enum (IN_PROGRESS, BLACK_WIN, WHITE_WIN, DRAW), 必須): ゲームのステータス
  - **moveHistory** (array[{x: number, y: number, player: enum}], 必須): プレイされた手の履歴

### 関係
- **GameController** → **Board**: 1:1 - コントローラーがボード状態を管理する
- **GameController** → **GameState**: 1:1 - コントローラーがゲーム状態を管理する

## 検証ルール

### 入力検証
- **石の配置位置**: 
  - ボード内の有効な交点であること
  - 既に石が置かれていないこと
  - ゲームが進行中であること

## ビジネスルール

- **五目並べの勝敗判定**
  - **条件**: 石を置いた後
  - **アクション**: 横、縦、斜め方向に5つ連続で同じ色の石があるか確認し、条件を満たす場合は勝者を決定

- **ターン交代**
  - **条件**: 有効な手が打たれた後
  - **アクション**: 現在のプレイヤーを黒から白、または白から黒に切り替える

- **引き分け判定**
  - **条件**: ボードが全て埋まった状態
  - **アクション**: 勝敗がついていない場合、ゲームを引き分けとする

## エラー処理

### エラーコード

- **INVALID_MOVE**
  - **メッセージ**: 無効な手です
  - **説明**: 既に石がある場所や無効な座標に石を置こうとした
  - **復旧方法**: 別の場所を選択するようユーザーに促す

- **GAME_OVER**
  - **メッセージ**: ゲームは既に終了しています
  - **説明**: ゲームが終了した状態で石を置こうとした
  - **復旧方法**: リセットボタンでゲームを再開するようユーザーに促す

## 品質属性

### ユーザビリティ
- **直感的なインターフェース**
  - **測定方法**: 初めてのユーザーが操作方法を説明なしで理解できること
- **レスポンシブデザイン**
  - **測定方法**: 様々な画面サイズで適切に表示されること

### 保守性
- **モジュール化された構造**
  - **測定方法**: コンポーネント単位でテスト可能であること
- **TypeScriptの型安全性**
  - **測定方法**: 型エラーが発生しないこと

## 実装詳細

### テクノロジー
- **TypeScript** (4.x or later): 型安全なコード開発
- **HTML5 Canvas** (標準): ゲームボードの描画
- **CSS3** (標準): レスポンシブなレイアウト

### アルゴリズム
- **連続石検出アルゴリズム**
  - **説明**: 指定された位置から8方向に連続する同色の石をカウントするアルゴリズム
  - **計算量**: O(n), n = 石の連続数（最大5）
- **ボード状態管理**
  - **説明**: 2次元配列でボードの状態を管理し、石の配置状態を追跡
  - **計算量**: O(1) - 配置・取得

### コード構造
- **models/**
  - **Board.ts**, **GameState.ts**: データモデルとゲームのロジック
- **components/**
  - **GameBoard.ts**, **GameStatus.ts**, **ResetButton.ts**: UIコンポーネント
- **controllers/**
  - **GameController.ts**: ゲームフローの制御
- **utils/**
  - **WinDetection.ts**: 勝利条件チェックなどのユーティリティ

## テスト戦略

### 単体テスト
- **WinDetection**
  - ケース: 水平方向の勝利, 垂直方向の勝利, 対角線方向の勝利, 勝利条件を満たさないケース
- **GameController**
  - ケース: ターン切り替え, 無効な手の処理, ゲームリセット

### 統合テスト
- **完全なゲームプレイ**
  - ステップ: ゲーム開始, 複数手の交互プレイ, 勝利条件の達成, 結果の表示, ゲームリセット

### UIテスト
- **レスポンシブデザイン**
  - デバイス: デスクトップ, タブレット, スマートフォン
  - チェック項目: ボード表示の適応, コントロールの配置